<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专业焦虑程度测评 | GAD-7 + SAS + BAI 三合一评估</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap">
    <style>
        /* ===== 基础重置 ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.12);
            overflow: hidden;
            padding: 40px;
            position: relative;
            animation: containerFade 0.8s ease-out;
        }

        @keyframes containerFade {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== 头部样式 ===== */
        header {
            text-align: center;
            padding: 30px 0 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: -40px -40px 40px;
            border-radius: 24px 24px 0 0;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" opacity="0.1"><path d="M0,50 Q250,10 500,50 T1000,50" fill="none" stroke="white" stroke-width="2"/></svg>');
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            font-weight: 700;
            letter-spacing: -0.5px;
            position: relative;
            z-index: 1;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
            font-weight: 300;
            position: relative;
            z-index: 1;
        }

        /* ===== 免责声明 ===== */
        .disclaimer {
            background: #fff3e0;
            border-left: 6px solid #ff9800;
            padding: 22px;
            margin: 30px 0;
            border-radius: 12px;
            animation: pulseWarning 3s infinite;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.15);
        }

        @keyframes pulseWarning {
            0%, 100% { border-left-color: #ff9800; }
            50% { border-left-color: #ffb74d; }
        }

        .disclaimer h3 {
            color: #e65100;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* ===== 进度条 ===== */
        .progress-container {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 18px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            margin: 35px 0;
            border: 2px solid #e3f2fd;
            position: sticky;
            top: 20px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-bar-bg {
            height: 14px;
            background: #e0e0e0;
            border-radius: 7px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A, #FFC107, #FF9800, #F44336);
            border-radius: 7px;
            transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            border-top: 4px solid;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        /* ===== 评分说明 ===== */
        .rating-instruction {
            background: #e8f5e9;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border: 2px dashed #4CAF50;
        }

        .rating-scale {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .rating-item {
            background: white;
            padding: 18px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .rating-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        /* ===== 题目区域 ===== */
        .scale-section {
            margin: 50px 0;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .scale-title {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 6px 20px rgba(106, 17, 203, 0.3);
        }

        .question-item {
            background: #fafafa;
            padding: 25px;
            margin: 20px 0;
            border-radius: 15px;
            border-left: 5px solid #ddd;
            transition: all 0.4s;
            animation: questionAppear 0.5s ease-out forwards;
            opacity: 0;
            animation-delay: calc(var(--order) * 0.05s);
        }

        @keyframes questionAppear {
            to { opacity: 1; }
        }

        .question-item:hover {
            background: #f0f7ff;
            border-left-color: #2196f3;
            transform: translateX(8px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.1);
        }

        .question-text {
            font-size: 1.15rem;
            margin-bottom: 20px;
            color: #222;
            font-weight: 500;
            line-height: 1.5;
        }

        /* ===== 选项按钮 ===== */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
        }

        .option-btn {
            padding: 14px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .option-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.6s;
        }

        .option-btn:hover {
            background: #e3f2fd;
            border-color: #2196f3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.2);
        }

        .option-btn:hover::before {
            left: 100%;
        }

        .option-btn.selected {
            background: #2196f3;
            color: white;
            border-color: #0d8bf2;
            box-shadow: 0 6px 12px rgba(33, 150, 243, 0.3);
            transform: scale(1.02);
        }

        .option-btn.selected::after {
            content: '✓';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
        }

        /* ===== 按钮区域 ===== */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 50px 0;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 18px 45px;
            font-size: 1.1rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.4s;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            min-width: 220px;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        }

        .action-btn:hover::before {
            animation: shine 1s;
        }

        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #43A047, #1B5E20);
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
            color: white;
            box-shadow: 0 8px 20px rgba(33, 150, 243, 0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #1E88E5, #0D3C82);
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(33, 150, 243, 0.4);
        }

        .btn-tertiary {
            background: linear-gradient(135deg, #FF9800, #EF6C00);
            color: white;
            box-shadow: 0 8px 20px rgba(255, 152, 0, 0.3);
        }

        .btn-tertiary:hover {
            background: linear-gradient(135deg, #FB8C00, #E65100);
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(255, 152, 0, 0.4);
        }

        /* ===== 结果面板 ===== */
        .result-panel {
            background: linear-gradient(135deg, #f8fdff 0%, #e3f2fd 100%);
            border: 2px solid #bbdefb;
            border-radius: 20px;
            padding: 40px;
            margin-top: 40px;
            display: none;
            animation: panelExpand 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes panelExpand {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .result-header {
            color: #1565c0;
            border-bottom: 3px solid #bbdefb;
            padding-bottom: 20px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 1.8rem;
        }

        .scores-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .score-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border-top: 6px solid;
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
        }

        .score-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.12);
        }

        .score-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
        }

        .score-value {
            font-size: 3.2rem;
            font-weight: 800;
            text-align: center;
            margin: 15px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .interpretation-box {
            background: #e8f5e9;
            padding: 25px;
            border-radius: 15px;
            margin-top: 35px;
            border-left: 6px solid #4CAF50;
            animation: fadeIn 1s ease-out;
        }

        /* ===== 页脚 ===== */
        footer {
            text-align: center;
            margin-top: 60px;
            padding-top: 25px;
            border-top: 1px solid #e0e0e0;
            color: #666;
            font-size: 0.95rem;
        }

        .footer-note {
            background: #fff9c4;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #ffecb3;
        }

        /* ===== 响应式设计 ===== */
        @media (max-width: 768px) {
            .container {
                padding: 25px;
                border-radius: 20px;
            }
            
            header {
                margin: -25px -25px 30px;
                padding: 25px 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .action-btn {
                width: 100%;
                max-width: 300px;
            }
            
            .progress-stats {
                grid-template-columns: 1fr;
            }
            
            .rating-scale {
                grid-template-columns: 1fr;
            }
        }

        /* ===== 工具类 ===== */
        .fade-in { animation: fadeIn 0.8s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .shake { animation: shake 0.5s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <header>
            <h1><i class="fas fa-brain"></i> 专业焦虑程度测评</h1>
            <p class="subtitle">GAD-7 + SAS + BAI 三合一评估 | 48题精准分析 | 国际标准量表</p>
        </header>

        <!-- 免责声明 -->
        <div class="disclaimer fade-in">
            <h3><i class="fas fa-exclamation-triangle"></i> 重要声明</h3>
            <p><strong>本测评结果仅供参考，不能替代专业医疗诊断。</strong> 如果您有严重焦虑症状，建议咨询心理医生或精神科医师。测评数据仅用于自我了解，我们不会存储您的个人信息。</p>
        </div>

        <!-- 评分说明 -->
        <div class="rating-instruction fade-in">
            <h3><i class="fas fa-clipboard-check"></i> 评分说明</h3>
            <p>请根据<strong>最近两周</strong>的实际情况，选择最符合的选项：</p>
            <div class="rating-scale">
                <div class="rating-item" style="border-top-color: #4CAF50;">
                    <strong>1分 - 没有或很少时间</strong>
                    <p>症状偶尔出现，基本不影响</p>
                </div>
                <div class="rating-item" style="border-top-color: #FFC107;">
                    <strong>2分 - 小部分时间</strong>
                    <p>症状有时出现，轻度影响</p>
                </div>
                <div class="rating-item" style="border-top-color: #FF9800;">
                    <strong>3分 - 相当多时间</strong>
                    <p>症状经常出现，明显影响</p>
                </div>
                <div class="rating-item" style="border-top-color: #F44336;">
                    <strong>4分 - 绝大部分时间</strong>
                    <p>症状持续存在，严重影响</p>
                </div>
            </div>
        </div>

        <!-- 进度条 -->
        <div id="progressContainer" class="progress-container">
            <div class="progress-header">
                <h3><i class="fas fa-tasks"></i> 答题进度</h3>
                <div id="progressPercent" style="font-size: 1.3rem; font-weight: 700; color: #2196F3;">0% (0/48)</div>
            </div>
            <div class="progress-bar-bg">
                <div id="progressBar" class="progress-bar-fill"></div>
            </div>
            <div class="progress-stats">
                <div class="stat-card" style="border-top-color: #4CAF50;">
                    <div><i class="fas fa-check-circle"></i> 已完成</div>
                    <div id="progressCount" style="font-size: 1.8rem; font-weight: 700; color: #4CAF50;">0</div>
                    <div>题</div>
                </div>
                <div class="stat-card" style="border-top-color: #2196F3;">
                    <div><i class="fas fa-clock"></i> 剩余</div>
                    <div id="remainingCount" style="font-size: 1.8rem; font-weight: 700; color: #2196F3;">48</div>
                    <div>题</div>
                </div>
                <div class="stat-card" style="border-top-color: #9C27B0;">
                    <div><i class="fas fa-chart-line"></i> 完成率</div>
                    <div id="completionRate" style="font-size: 1.8rem; font-weight: 700; color: #9C27B0;">0%</div>
                    <div>预计时间: 8-10分钟</div>
                </div>
            </div>
        </div>

        <!-- 题目区域 -->
        <div id="questionnaire">
            <!-- 题目通过JavaScript动态生成 -->
        </div>

        <!-- 操作按钮 -->
        <div class="action-buttons">
            <button class="action-btn btn-secondary" onclick="checkCompletion()">
                <i class="fas fa-chart-bar"></i> 检查完成情况
            </button>
            <button class="action-btn btn-primary" onclick="calculateScore()">
                <i class="fas fa-calculator"></i> 提交并查看结果
            </button>
            <button class="action-btn btn-tertiary" onclick="resetAll()">
                <i class="fas fa-redo"></i> 重新开始测评
            </button>
        </div>

        <!-- 结果面板 -->
        <div id="resultPanel" class="result-panel">
            <h2 class="result-header"><i class="fas fa-chart-line"></i> 测评结果分析报告</h2>
            
            <div class="scores-container" id="scoresContainer">
                <!-- 分数卡片通过JavaScript动态生成 -->
            </div>
            
            <div id="interpretationBox" class="interpretation-box">
                <h3><i class="fas fa-comment-medical"></i> 综合解读与建议</h3>
                <p id="interpretationText">请提交问卷后查看详细解读...</p>
            </div>
            
            <div style="text-align: center; margin-top: 35px;">
                <button class="action-btn btn-secondary" onclick="window.print()" style="min-width: 180px;">
                    <i class="fas fa-print"></i> 打印此报告
                </button>
            </div>
        </div>

        <!-- 完成提示 -->
        <div id="completionAlert" style="display:none; background:#e8f5e9; border:2px solid #4CAF50; padding:20px; border-radius:12px; margin:25px 0; animation: fadeIn 0.5s;">
            <!-- 提示内容动态生成 -->
        </div>

        <!-- 页脚 -->
        <footer>
            <p><i class="fas fa-heartbeat"></i> <strong>心理健康提示：</strong>定期进行心理测评有助于了解自身状态，如有需要请寻求专业帮助。</p>
            <div class="footer-note">
                <p><i class="fas fa-info-circle"></i> 本测评基于GAD-7、SAS、BAI三个国际标准焦虑量表，结果具有参考价值。</p>
            </div>
            <p style="margin-top: 20px;">© 2023 专业焦虑测评系统 | 设计：jasmine2025888.github.io</p>
        </footer>
    </div>

    <script>
        // ===== 焦虑测评数据 =====
        const anxietyQuestions = [
            {
                scale: "GAD-7广泛性焦虑量表",
                description: "7题，国际通用焦虑筛查工具",
                items: [
                    "1. 感到紧张、焦虑或急切",
                    "2. 不能停止或控制担忧",
                    "3. 对各种各样的事情担忧过多",
                    "4. 很难放松下来",
                    "5. 由于不安而无法静坐",
                    "6. 变得容易烦恼或急躁",
                    "7. 感到似乎将有可怕的事情发生而害怕"
                ]
            },
            {
                scale: "SAS焦虑自评量表", 
                description: "20题，中国常用焦虑评估量表",
                items: [
                    "8. 我觉得比平时容易紧张和着急",
                    "9. 我无缘无故地感到害怕",
                    "10. 我容易心里烦乱或觉得惊恐",
                    "11. 我觉得我可能将要发疯",
                    "12. 我觉得一切都很好，也不会发生什么不幸",
                    "13. 我手脚发抖打颤",
                    "14. 我因为头痛、颈痛和背痛而苦恼",
                    "15. 我感觉容易衰弱和疲乏",
                    "16. 我觉得心平气和，并且容易安静坐着",
                    "17. 我觉得心跳很快",
                    "18. 我因为一阵阵头晕而苦恼",
                    "19. 我有晕倒发作或觉得要晕倒似的",
                    "20. 我呼气吸气都感到很容易",
                    "21. 我手脚麻木和刺痛",
                    "22. 我因为胃痛和消化不良而苦恼",
                    "23. 我常常要小便",
                    "24. 我的手常常是干燥温暖的",
                    "25. 我脸红发热",
                    "26. 我容易入睡并且一夜睡得很好",
                    "27. 我做恶梦"
                ]
            },
            {
                scale: "BAI贝克焦虑量表",
                description: "21题，侧重躯体焦虑症状",
                items: [
                    "28. 麻木或刺痛感",
                    "29. 感到发热",
                    "30. 腿部颤抖",
                    "31. 不能放松",
                    "32. 害怕发生不好的事情",
                    "33. 头晕",
                    "34. 心悸或心率加快",
                    "35. 心神不定",
                    "36. 惊吓",
                    "37. 紧张",
                    "38. 窒息感",
                    "39. 手发抖",
                    "40. 身体摇晃感",
                    "41. 害怕失控",
                    "42. 呼吸困难",
                    "43. 害怕快要死去",
                    "44. 恐慌",
                    "45. 消化不良或腹部不适",
                    "46. 昏厥感",
                    "47. 脸发红",
                    "48. 出汗（不是因暑热出汗）"
                ]
            }
        ];

        // ===== 全局变量 =====
        let userAnswers = {};
        let questionElements = [];

        // ===== 初始化题目 =====
        function initializeQuestions() {
            const container = document.getElementById('questionnaire');
            container.innerHTML = '';
            questionElements = [];
            
            let questionIndex = 0;
            
            anxietyQuestions.forEach((scaleData, scaleIndex) => {
                // 创建量表标题
                const scaleTitle = document.createElement('div');
                scaleTitle.className = 'scale-title';
                scaleTitle.innerHTML = `
                    <div>
                        <h3 style="margin:0; font-size:1.4rem;">${scaleData.scale}</h3>
                        <p style="margin:5px 0 0; opacity:0.9; font-size:0.95rem;">${scaleData.description}</p>
                    </div>
                    <div id="scale${scaleIndex}Score" style="background:rgba(255,255,255,0.2); padding:8px 15px; border-radius:20px;">
                        未完成
                    </div>
                `;
                container.appendChild(scaleTitle);
                
                // 创建题目
                scaleData.items.forEach((itemText, itemIndex) => {
                    questionIndex++;
                    const questionId = `q${questionIndex}`;
                    
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-item';
                    questionDiv.id = questionId;
                    questionDiv.style.setProperty('--order', questionIndex);
                    
                    questionDiv.innerHTML = `
                        <div class="question-text">${itemText}</div>
                        <div class="options-grid">
                            <div class="option-btn" data-value="1" onclick="selectOption('${questionId}', 1)">
                                <div style="font-weight:600; color:#4CAF50;">1分</div>
                                <div style="font-size:0.9rem; margin-top:4px;">没有或很少时间</div>
                            </div>
                            <div class="option-btn" data-value="2" onclick="selectOption('${questionId}', 2)">
                                <div style="font-weight:600; color:#FFC107;">2分</div>
                                <div style="font-size:0.9rem; margin-top:4px;">小部分时间</div>
                            </div>
                            <div class="option-btn" data-value="3" onclick="selectOption('${questionId}', 3)">
                                <div style="font-weight:600; color:#FF9800;">3分</div>
                                <div style="font-size:0.9rem; margin-top:4px;">相当多时间</div>
                            </div>
                            <div class="option-btn" data-value="4" onclick="selectOption('${questionId}', 4)">
                                <div style="font-weight:600; color:#F44336;">4分</div>
                                <div style="font-size:0.9rem; margin-top:4px;">绝大部分时间</div>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(questionDiv);
                    questionElements.push(questionDiv);
                });
            });
            
            updateProgress();
            updateScaleCompletion();
        }

        // ===== 选择选项 =====
        function selectOption(questionId, value) {
            const questionDiv = document.getElementById(questionId);
            const buttons = questionDiv.querySelectorAll('.option-btn');
            
            // 动画效果：移除其他选项的选中状态
            buttons.forEach(btn => {
                if (btn.classList.contains('selected')) {
                    btn.classList.remove('selected');
                    btn.style.animation = 'none';
                    setTimeout(() => {
                        btn.style.animation = '';
                    }, 10);
                }
            });
            
            // 添加选中状态
            buttons.forEach(btn => {
                if (parseInt(btn.getAttribute('data-value')) === value) {
                    btn.classList.add('selected');
                    btn.classList.add('pulse');
                    setTimeout(() => {
                        btn.classList.remove('pulse');
                    }, 500);
                }
            });
            
            // 存储答案
            userAnswers[questionId] = value;
            
            // 更新显示
            updateProgress();
            updateScaleCompletion();
            
            // 视觉反馈
            questionDiv.classList.add('shake');
            setTimeout(() => {
                questionDiv.classList.remove('shake');
            }, 500);
        }

        // ===== 更新进度 =====
        function updateProgress() {
            const totalQuestions = 48;
            const answered = Object.keys(userAnswers).length;
            const percent = Math.round((answered / totalQuestions) * 100);
            
            // 更新进度条
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            const progressCount = document.getElementById('progressCount');
            const remainingCount = document.getElementById('remainingCount');
            const completionRate = document.getElementById('completionRate');
            
            if (progressBar) {
                progressBar.style.width = percent + '%';
                progressPercent.textContent = percent + '% (' + answered + '/48)';
                progressCount.textContent = answered;
                remainingCount.textContent = totalQuestions - answered;
                completionRate.textContent = percent + '%';
                
                // 动态颜色
                if (percent >= 100) {
                    progressBar.style.background = 'linear-gradient(90deg, #4CAF50, #2E7D32)';
                    progressPercent.innerHTML = '<i class="fas fa-check-circle"></i> 已完成所有题目';
                } else if (percent >= 75) {
                    progressBar.style.background = 'linear-gradient(90deg, #FFC107, #FF9800)';
                } else if (percent >= 50) {
                    progressBar.style.background = 'linear-gradient(90deg, #8BC34A, #CDDC39)';
                } else if (percent >= 25) {
                    progressBar.style.background = 'linear-gradient(90deg, #4CAF50, #8BC34A)';
                }
            }
            
            // 更新题目显示顺序（已答的往下移）
            questionElements.forEach((div, index) => {
                const qId = div.id;
                if (userAnswers[qId] !== undefined) {
                    div.style.opacity = '0.9';
                    div.style.order = index + 1000; // 已答的放后面
                } else {
                    div.style.opacity = '1';
                    div.style.order = index;
                }
            });
        }

        // ===== 更新量表完成状态 =====
        function updateScaleCompletion() {
            anxietyQuestions.forEach((scaleData, scaleIndex) => {
                const startIdx = scaleIndex === 0 ? 1 : (scaleIndex === 1 ? 8 : 29);
                const endIdx = scaleIndex === 0 ? 7 : (scaleIndex === 1 ? 27 : 48);
                let completed = 0;
                let totalScore = 0;
                
                for (let i = startIdx; i <= endIdx; i++) {
                    const qId = `q${i}`;
                    if (userAnswers[qId] !== undefined) {
                        completed++;
                        totalScore += userAnswers[qId
                                              }
                }
                
                const totalInScale = endIdx - startIdx + 1;
                const scaleScoreElement = document.getElementById(`scale${scaleIndex}Score`);
                
                if (completed === totalInScale) {
                    const avgScore = (totalScore / totalInScale).toFixed(2);
                    scaleScoreElement.innerHTML = `已完成 | 均分: ${avgScore}`;
                    scaleScoreElement.style.background = 'rgba(76, 175, 80, 0.3)';
                } else {
                    scaleScoreElement.innerHTML = `已完成 ${completed}/${totalInScale} 题`;
                    scaleScoreElement.style.background = completed > 0 ? 
                        'rgba(255, 152, 0, 0.3)' : 'rgba(255, 255, 255, 0.2)';
                }
            });
        }

        // ===== 检查完成情况 =====
        function checkCompletion() {
            const totalQuestions = 48;
            const answered = Object.keys(userAnswers).length;
            
            const alertDiv = document.getElementById('completionAlert');
            alertDiv.style.display = 'block';
            
            if (answered === totalQuestions) {
                alertDiv.innerHTML = `
                    <h3 style="color:#4CAF50; margin-bottom:10px;">
                        <i class="fas fa-check-circle"></i> 恭喜！已完成所有${totalQuestions}题
                    </h3>
                    <p>您可以点击"提交并查看结果"按钮查看详细测评报告。</p>
                `;
                alertDiv.style.background = '#e8f5e9';
                alertDiv.style.borderColor = '#4CAF50';
            } else {
                const remaining = totalQuestions - answered;
                alertDiv.innerHTML = `
                    <h3 style="color:#FF9800; margin-bottom:10px;">
                        <i class="fas fa-exclamation-triangle"></i> 完成进度：${answered}/${totalQuestions}题
                    </h3>
                    <p>您还有${remaining}题未作答。请完成所有题目后提交获取准确结果。</p>
                    <div style="margin-top:15px; display:flex; gap:10px; flex-wrap:wrap;">
                        <button class="option-btn" style="padding:8px 15px; font-size:0.9rem;" 
                                onclick="scrollToFirstUnanswered()">
                            <i class="fas fa-arrow-down"></i> 跳转到第一题未答题目
                        </button>
                    </div>
                `;
                alertDiv.style.background = '#fff3cd';
                alertDiv.style.borderColor = '#ffeaa7';
            }
            
            // 5秒后自动隐藏
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 7000);
        }

        // ===== 滚动到第一题未答题目 =====
        function scrollToFirstUnanswered() {
            for (let i = 1; i <= 48; i++) {
                const qId = `q${i}`;
                if (userAnswers[qId] === undefined) {
                    const element = document.getElementById(qId);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        element.classList.add('pulse');
                        setTimeout(() => {
                            element.classList.remove('pulse');
                        }, 2000);
                        break;
                    }
                }
            }
        }

        // ===== 计算分数 =====
        function calculateScore() {
            const totalQuestions = 48;
            const answered = Object.keys(userAnswers).length;
            
            if (answered < totalQuestions) {
                alert(`请完成所有题目后再提交！\n当前完成：${answered}/${totalQuestions}题`);
                checkCompletion();
                return;
            }
            
            // 计算三个量表分数
            // 1. GAD-7 (1-7题)
            let gad7Score = 0;
            for (let i = 1; i <= 7; i++) {
                gad7Score += userAnswers[`q${i}`] || 0;
            }
            const gad7Level = gad7Score <= 4 ? "正常" : 
                              gad7Score <= 9 ? "轻度焦虑" : 
                              gad7Score <= 14 ? "中度焦虑" : "重度焦虑";
            
            // 2. SAS (8-27题，需要转换：反向题目12、16、19、23、26需要反算)
            let sasRawScore = 0;
            for (let i = 8; i <= 27; i++) {
                let score = userAnswers[`q${i}`] || 0;
                // SAS的反向题目（12、16、19、23、26题）计分反转
                if ([12, 16, 19, 23, 26].includes(i)) {
                    score = 5 - score; // 1分变4分，2分变3分，以此类推
                }
                sasRawScore += score;
            }
            // SAS标准分 = 原始总分 × 1.25
            const sasStandardScore = Math.round(sasRawScore * 1.25);
            const sasLevel = sasStandardScore < 50 ? "正常" : 
                             sasStandardScore <= 59 ? "轻度焦虑" : 
                             sasStandardScore <= 69 ? "中度焦虑" : "重度焦虑";
            
            // 3. BAI (28-48题)
            let baiScore = 0;
            for (let i = 28; i <= 48; i++) {
                baiScore += userAnswers[`q${i}`] || 0;
            }
            const baiLevel = baiScore <= 21 ? "正常" : 
                             baiScore <= 35 ? "轻度焦虑" : 
                             baiScore <= 53 ? "中度焦虑" : "重度焦虑";
            
            // 显示结果面板
            const resultPanel = document.getElementById('resultPanel');
            resultPanel.style.display = 'block';
            
            // 生成分数卡片
            const scoresContainer = document.getElementById('scoresContainer');
            scoresContainer.innerHTML = '';
            
            const scoreCards = [
                {
                    title: "GAD-7广泛性焦虑",
                    rawScore: gad7Score,
                    standardScore: gad7Score,
                    level: gad7Level,
                    color: "#2196F3",
                    description: "7题总分，国际通用筛查工具"
                },
                {
                    title: "SAS焦虑自评",
                    rawScore: sasRawScore,
                    standardScore: sasStandardScore,
                    level: sasLevel,
                    color: "#4CAF50",
                    description: "标准分=原始分×1.25，≥50分提示焦虑"
                },
                {
                    title: "BAI贝克焦虑",
                    rawScore: baiScore,
                    standardScore: baiScore,
                    level: baiLevel,
                    color: "#9C27B0",
                    description: "侧重躯体焦虑症状评估"
                }
            ];
            
            scoreCards.forEach(card => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'score-card';
                cardDiv.style.borderTopColor = card.color;
                cardDiv.innerHTML = `
                    <h3 style="color:${card.color}; margin-bottom:15px;">
                        <i class="fas fa-chart-bar"></i> ${card.title}
                    </h3>
                    <div class="score-value" style="color:${card.color};">${card.standardScore}</div>
                    <div style="text-align:center; margin-bottom:15px;">
                        <span style="background:${card.color}; color:white; padding:6px 15px; border-radius:20px; font-weight:600;">
                            ${card.level}
                        </span>
                    </div>
                    <div style="color:#666; font-size:0.9rem; line-height:1.5;">
                        <div>原始分: ${card.rawScore}</div>
                        <div>${card.description}</div>
                    </div>
                `;
                scoresContainer.appendChild(cardDiv);
            });
            
            // 综合解读
            const interpretationBox = document.getElementById('interpretationBox');
            const interpretationText = document.getElementById('interpretationText');
            
            // 判断最严重的等级
            const levels = [gad7Level, sasLevel, baiLevel];
            const hasSevere = levels.includes("重度焦虑");
            const hasModerate = levels.includes("中度焦虑");
            const hasMild = levels.includes("轻度焦虑");
            
            let interpretation = "";
            let adviceColor = "#4CAF50";
            
            if (hasSevere) {
                interpretation = `
                    <p><strong>评估显示：您的焦虑水平较高，达到重度焦虑程度。</strong>三个量表结果均提示明显的焦虑症状，可能已对您的日常生活造成显著影响。</p>
                    <p style="margin-top:15px;"><strong>建议：</strong></p>
                    <ul style="margin-left:20px; margin-top:10px;">
                        <li>强烈建议尽快寻求专业心理医生或精神科医师的帮助</li>
                        <li>考虑认知行为疗法（CBT）或药物治疗</li>
                        <li>学习放松技巧，如深呼吸、冥想</li>
                        <li>保持规律作息，避免咖啡因和酒精</li>
                        <li>与信任的人谈论您的感受</li>
                    </ul>
                `;
                adviceColor = "#F44336";
            } else if (hasModerate) {
                interpretation = `
                    <p><strong>评估显示：您处于中度焦虑水平。</strong>部分量表提示焦虑症状较明显，可能已对您的工作和生活产生一定影响。</p>
                    <p style="margin-top:15px;"><strong>建议：</strong></p>
                    <ul style="margin-left:20px; margin-top:10px;">
                        <li>建议咨询心理专业人士进行评估</li>
                        <li>学习压力管理技巧，如正念冥想</li>
                        <li>保持适度运动，每周3-4次，每次30分钟</li>
                        <li>建立规律的睡眠时间表</li>
                        <li>记录焦虑触发因素，寻找应对策略</li>
                    </ul>
                `;
                adviceColor = "#FF9800";
            } else if (hasMild) {
                interpretation = `
                    <p><strong>评估显示：您处于轻度焦虑水平。</strong>这是很多人都会经历的阶段，通常与生活压力有关，但尚未对功能造成严重影响。</p>
                    <p style="margin-top:15px;"><strong>建议：</strong></p>
                    <ul style="margin-left:20px; margin-top:10px;">
                        <li>学习放松技巧，每天练习10-15分钟</li>
                        <li>保持健康的生活方式，均衡饮食</li>
                        <li>与他人分享您的担忧，不要独自承受</li>
                        <li>尝试写日记，记录情绪变化</li>
                        <li>如症状持续或加重，请寻求专业帮助</li>
                    </ul>
                `;
                adviceColor = "#FFC107";
            } else {
                interpretation = `
                    <p><strong>评估显示：您的焦虑水平在正常范围内。</strong>三个量表结果均未提示明显的焦虑症状，这是良好的心理健康状态。</p>
                    <p style="margin-top:15px;"><strong>保持建议：</strong></p>
                    <ul style="margin-left:20px; margin-top:10px;">
                        <li>继续保持健康的生活习惯</li>
                        <li>学习压力管理技巧以备不时之需</li>
                        <li>定期关注自己的情绪状态</li>
                        <li>帮助身边可能有需要的人</li>
                        <li>每3-6个月可进行一次自我评估</li>
                    </ul>
                `;
                adviceColor = "#4CAF50";
            }
            
            interpretationBox.style.borderLeftColor = adviceColor;
            interpretationText.innerHTML = interpretation;
            
            // 滚动到结果区域
            resultPanel.scrollIntoView({ behavior: 'smooth' });
            
            // 添加打印优化
            const style = document.createElement('style');
            style.innerHTML = `
                @media print {
                    body * {
                        visibility: hidden;
                    }
                    .container, .container * {
                        visibility: visible;
                    }
                    .container {
                        position: absolute;
                        left: 0;
                        top: 0;
                        box-shadow: none;
                    }
                    .action-btn, .progress-container {
                        display: none !important;
                    }
                }
            `;
            document.head.appendChild(style);
        }

        // ===== 重置所有 =====
        function resetAll() {
            if (confirm('确定要重置所有答案吗？这将清除所有已选项，重新开始测评。')) {
                userAnswers = {};
                initializeQuestions();
                document.getElementById('resultPanel').style.display = 'none';
                document.getElementById('completionAlert').style.display = 'none';
                
                // 滚动到顶部
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // ===== 页面加载初始化 =====
        window.onload = function() {
            initializeQuestions();
            
            // 添加键盘快捷键
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    calculateScore();
                }
                if (e.key === 'Escape') {
                    resetAll();
                }
            });
            
            // 添加页面加载动画
            setTimeout(() => {
                document.querySelectorAll('.fade-in').forEach(el => {
                    el.style.animationPlayState = 'running';
                });
            }, 300);
        };
    </script>
</body>
</html>
