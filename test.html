<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPD自恋型人格专业测试</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #4361ee;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1rem;
        }
        
        .progress {
            background: #ecf0f1;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #4361ee, #3a0ca3);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .question-container {
            display: none;
        }
        
        .question-container.active {
            display: block;
        }
        
        .question-number {
            background: #4361ee;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 25px;
            color: #2c3e50;
            line-height: 1.5;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }
        
        .option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
        }
        
        .option:hover {
            background: #edf2ff;
            border-color: #4361ee;
        }
        
        .option.selected {
            background: #e7f0ff;
            border-color: #4361ee;
            color: #4361ee;
            font-weight: 500;
        }
        
        .option-score {
            float: right;
            color: #666;
            font-size: 0.9rem;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }
        
        .btn {
            padding: 14px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #4361ee;
            border: 2px solid #4361ee;
        }
        
        .btn-secondary:hover {
            background: #edf2ff;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .result-container {
            display: none;
            text-align: center;
        }
        
        .result-score {
            font-size: 3.5rem;
            font-weight: 800;
            color: #4361ee;
            margin: 20px 0;
        }
        
        .result-level {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .result-desc {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .result-details {
            text-align: left;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .dimension {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .dimension:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .dimension-name {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .dimension-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .dimension-fill {
            height: 100%;
            background: linear-gradient(90deg, #4cc9f0, #4361ee);
            border-radius: 4px;
        }
        
        .privacy-notice {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #2e7d32;
        }
        
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 0.9rem;
            color: #e65100;
        }
        
        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            
            .container {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .question-text {
                font-size: 1.1rem;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 0.95rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 欢迎页面 -->
        <div id="welcome" class="welcome-container">
            <div class="header">
                <h1>NPD自恋型人格专业测试</h1>
                <p>基于DSM-5标准和心理学研究的专业评估工具</p>
            </div>
            
            <div class="privacy-notice">
                <strong>⚠️ 隐私保护声明：</strong><br>
                所有测试数据仅存储在您的设备本地，不会被上传到任何服务器。关闭页面后数据将自动清除。
            </div>
            
            <div style="margin: 25px 0;">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">测试说明：</h3>
                <ul style="list-style: none; padding-left: 5px;">
                    <li style="margin-bottom: 10px; padding-left: 25px; position: relative;">
                        <span style="position: absolute; left: 0; color: #4361ee;">•</span>
                        共 <strong>30道题目</strong>，基于过去6个月的观察
                    </li>
                    <li style="margin-bottom: 10px; padding-left: 25px; position: relative;">
                        <span style="position: absolute; left: 0; color: #4361ee;">•</span>
                        每题选择最符合观察到的<strong>行为频率</strong>
                    </li>
                    <li style="margin-bottom: 10px; padding-left: 25px; position: relative;">
                        <span style="position: absolute; left: 0; color: #4361ee;">•</span>
                        完成时间约 <strong>5-8分钟</strong>
                    </li>
                    <li style="margin-bottom: 10px; padding-left: 25px; position: relative;">
                        <span style="position: absolute; left: 0; color: #4361ee;">•</span>
                        测试结束后生成<strong>详细分析报告</strong>
                    </li>
                </ul>
            </div>
            
            <div class="warning-box">
                <strong>重要声明：</strong><br>
                本测试为行为观察辅助工具，结果仅供参考和自我探索，不构成专业心理诊断。如需专业帮助，请咨询持证心理咨询师。
            </div>
            
            <button id="startTest" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                开始专业测试
            </button>
        </div>
        
        <!-- 测试页面 -->
        <div id="test" style="display: none;">
            <div class="progress-info">
                <span id="currentQuestion">第1题</span>
                <span id="progressPercent">0%</span>
            </div>
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div id="questionContainer">
                <!-- 题目由JavaScript动态生成 -->
            </div>
            
            <div class="navigation">
                <button id="prevBtn" class="btn btn-secondary" disabled>上一题</button>
                <button id="nextBtn" class="btn btn-primary">下一题</button>
            </div>
        </div>
        
        <!-- 结果页面 -->
        <div id="result" class="result-container" style="display: none;">
            <div class="header">
                <h1>测试完成</h1>
                <p>您的NPD行为模式评估报告</p>
            </div>
            
            <div class="result-score" id="totalScore">0</div>
            <div class="result-level" id="riskLevel">分析中...</div>
            <div class="result-desc" id="resultDesc"></div>
            
            <div class="result-details">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">各维度得分：</h3>
                <div id="dimensionsList">
                    <!-- 维度得分由JavaScript生成 -->
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <button id="restartBtn" class="btn btn-secondary" style="margin-right: 10px;">
                    重新测试
                </button>
                <button id="shareBtn" class="btn btn-primary">
                    保存结果
                </button>
            </div>
            
            <div class="warning-box" style="margin-top: 30px;">
                <strong>温馨提示：</strong><br>
                本测试结果基于您的主观观察，仅供参考。人际关系中的行为模式复杂多样，建议结合专业咨询进行综合判断。
            </div>
        </div>
    </div>

    <script>
        // NPD测试题目数据库（30道专业题目）
        const questions = [
            // 自我夸大维度（1-5题）
            { 
                text: "是否经常夸大自己的成就和才能？", 
                dimension: "自我夸大",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否幻想自己拥有无限的成功、权力、才华或美貌？", 
                dimension: "自我夸大",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否认为自己与众不同，只能被其他特殊或高层次的人理解？", 
                dimension: "自我夸大",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否要求他人给予自己过度的钦佩？", 
                dimension: "自我夸大",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否表现出傲慢、目中无人的行为或态度？", 
                dimension: "自我夸大",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            // 特权感维度（6-10题）
            { 
                text: "是否不合理地期望自己受到特别优待或他人自动顺从自己的期望？", 
                dimension: "特权感",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否利用他人来达到自己的目的？", 
                dimension: "特权感",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否缺乏同理心，不愿认识或认同他人的感受和需求？", 
                dimension: "特权感",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否经常嫉妒他人，或认为他人嫉妒自己？", 
                dimension: "特权感",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否在争论或失败时表现得愤怒或羞辱？", 
                dimension: "特权感",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            // 人际关系维度（11-15题）
            { 
                text: "是否在人际关系中表现出剥削性行为？", 
                dimension: "人际关系",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否难以维持长期稳定的亲密关系？", 
                dimension: "人际关系",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否对他人的批评过度敏感？", 
                dimension: "人际关系",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否经常在背后说人坏话或贬低他人？", 
                dimension: "人际关系",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否在需要时表现出魅力，但本质上缺乏真诚的情感连接？", 
                dimension: "人际关系",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            // 情感反应维度（16-20题）
            { 
                text: "情绪是否在理想化和贬低他人之间快速切换？", 
                dimension: "情感反应",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否缺乏深度的情感体验？", 
                dimension: "情感反应",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否经常感到空虚或无聊？", 
                dimension: "情感反应",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否难以表达脆弱或真实的情感？", 
                dimension: "情感反应",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否经常使用愤怒来控制他人或情境？", 
                dimension: "情感反应",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            // 共情能力维度（21-25题）
            { 
                text: "是否能真正理解他人的感受和观点？", 
                dimension: "共情能力",
                options: [
                    { text: "总是", score: 0 },
                    { text: "经常", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "很少", score: 3 },
                    { text: "从不", score: 4 }
                ]
            },
            { 
                text: "是否在他人痛苦或需要时提供情感支持？", 
                dimension: "共情能力",
                options: [
                    { text: "总是", score: 0 },
                    { text: "经常", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "很少", score: 3 },
                    { text: "从不", score: 4 }
                ]
            },
            { 
                text: "是否能真诚地为他人的成功感到高兴？", 
                dimension: "共情能力",
                options: [
                    { text: "总是", score: 0 },
                    { text: "经常", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "很少", score: 3 },
                    { text: "从不", score: 4 }
                ]
            },
            { 
                text: "是否考虑自己的行为对他人造成的影响？", 
                dimension: "共情能力",
                options: [
                    { text: "总是", score: 0 },
                    { text: "经常", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "很少", score: 3 },
                    { text: "从不", score: 4 }
                ]
            },
            { 
                text: "是否能承认自己的错误并向他人道歉？", 
                dimension: "共情能力",
                options: [
                    { text: "总是", score: 0 },
                    { text: "经常", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "很少", score: 3 },
                    { text: "从不", score: 4 }
                ]
            },
            // 行为模式维度（26-30题）
            { 
                text: "是否经常将自己的问题归咎于他人？", 
                dimension: "行为模式",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否难以接受与自己不同的意见？", 
                dimension: "行为模式",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否经常表现出控制他人的行为？", 
                dimension: "行为模式",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否在人际关系中设置不健康的边界？", 
                dimension: "行为模式",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            },
            { 
                text: "是否表现出完美主义，并对他人有过高期望？", 
                dimension: "行为模式",
                options: [
                    { text: "从不", score: 0 },
                    { text: "很少", score: 1 },
                    { text: "有时", score: 2 },
                    { text: "经常", score: 3 },
                    { text: "总是", score: 4 }
                ]
            }
        ];

        // 测试状态管理
        let currentQuestion = 0;
        let answers = new Array(questions.length).fill(null);
        let testStarted = false;

        // DOM元素
        const welcomeEl = document.getElementById('welcome');
        const testEl = document.getElementById('test');
        const resultEl = document.getElementById('result');
        const startBtn = document.getElementById('startTest');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const questionContainer = document.getElementById('questionContainer');
        const currentQuestionEl = document.getElementById('currentQuestion');
        const progressBar = document.getElementById('progressBar');
        const progressPercent = document.getElementById('progressPercent');
        const totalScoreEl = document.getElementById('totalScore');
        const riskLevelEl = document.getElementById('riskLevel');
        const resultDescEl = document.getElementById('resultDesc');
        const dimensionsList = document.getElementById('dimensionsList');
        const restartBtn = document.getElementById('restartBtn');
        const shareBtn = document.getElementById('shareBtn');

        // 从本地存储加载答案
        function loadAnswers() {
            const saved = localStorage.getItem('npdTestAnswers');
            if (saved) {
                answers = JSON.parse(saved);
                // 检查是否有已回答的问题
                const answeredCount = answers.filter(a => a !== null).length;
                if (answeredCount > 0 && answeredCount < questions.length) {
                    if (confirm(`检测到未完成的测试（已完成${answeredCount}/30题），是否继续？`)) {
                        currentQuestion = answeredCount;
                        startTest();
                        return;
                    }
                }
            }
            answers = new Array(questions.length).fill(null);
        }

        // 保存答案到本地存储
        function saveAnswers() {
            localStorage.setItem('npdTestAnswers', JSON.stringify(answers));
        }

        // 开始测试
        function startTest() {
            welcomeEl.style.display = 'none';
            testEl.style.display = 'block';
            testStarted = true;
            loadAnswers();
            showQuestion(currentQuestion);
        }

        // 显示题目
        function showQuestion(index) {
            if (index < 0 || index >= questions.length) return;
            
            currentQuestion = index;
            const question = questions[index];
            
            // 更新进度
            const progress = ((index + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressPercent.textContent = `${Math.round(progress)}%`;
            currentQuestionEl.textContent = `第${index + 1}题`;
            
            // 更新按钮状态
            prevBtn.disabled = index === 0;
            nextBtn.textContent = index === questions.length - 1 ? '查看结果' : '下一题';
            
            // 生成题目HTML
            questionContainer.innerHTML = `
                <div class="question-number">${index + 1}</div>
                <div class="question-text">${question.text}</div>
                <div class="options">
                    ${question.options.map((option, i) => `
                        <div class="option ${answers[index] === i ? 'selected' : ''}" 
                             data-index="${i}" 
                             data-score="${option.score}">
                            ${option.text}
                            <span class="option-score">${option.score}分</span>
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                    <strong>评估维度：</strong>${question.dimension}
                </div>
            `;
            
            // 添加选项点击事件
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function() {
                    // 移除其他选项的选中状态
                    document.querySelectorAll('.option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // 选中当前选项
                    this.classList.add('selected');
                    
                    // 保存答案
                    const optionIndex = parseInt(this.getAttribute('data-index'));
                    answers[index] = optionIndex;
                    saveAnswers();
                    
                    // 启用下一题按钮
                    nextBtn.disabled = false;
                });
            });
            
            // 如果这个问题已经回答过，启用下一题按钮
            nextBtn.disabled = answers[index] === null;
        }

        // 上一题
        function prevQuestion() {
            if (currentQuestion > 0) {
                showQuestion(currentQuestion - 1);
            }
        }

        // 下一题或查看结果
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                showQuestion(currentQuestion + 1);
            } else {
                calculateResults();
            }
        }

        // 计算测试结果
        function calculateResults() {
            // 计算总分
            let totalScore = 0;
            questions.forEach((q, index) => {
                if (answers[index] !== null) {
                    totalScore += q.options[answers[index]].score;
                }
            });
            
            // 计算各维度得分
            const dimensions = {};
            questions.forEach((q, index) => {
                if (answers[index] !== null) {
                    const score = q.options[answers[index]].score;
                    if (!dimensions[q.dimension]) {
                        dimensions[q.dimension] = { total: 0, count: 0 };
                    }
                    dimensions[q.dimension].total += score;
                    dimensions[q.dimension].count++;
                }
            });
            
            // 计算平均分
            const dimensionAverages = {};
            Object.keys(dimensions).forEach(dim => {
                dimensionAverages[dim] = dimensions[dim].total / dimensions[dim].count;
            });
            
            // 确定风险等级
            let riskLevel, description, color;
            if (totalScore < 40) {
                riskLevel = "低风险";
                description = "观察到的自恋特质在正常范围内。这可能表示健康自信与适度自恋的平衡。";
                color = "#4CAF50";
            } else if (totalScore < 80) {
                riskLevel = "中等风险";
                description = "观察到一定程度的自恋特质。建议关注这些行为模式对人际关系的影响。";
                color = "#FF9800";
            } else if (totalScore < 100) {
                riskLevel = "高风险";
                description = "观察到显著的自恋行为模式。建议寻求专业心理咨询师的进一步评估。";
                color = "#F44336";
            } else {
                riskLevel = "极高风险";
                description = "观察到强烈的自恋人格特质。强烈建议寻求专业心理健康支持。";
                color = "#D32F2F";
            }
            
            // 显示结果
            testEl.style.display = 'none';
            resultEl.style.display = 'block';
            
            totalScoreEl.textContent = totalScore;
            riskLevelEl.textContent = riskLevel;
            riskLevelEl.style.color = color;
            resultDescEl.textContent = description;
            
            // 显示各维度得分
            dimensionsList.innerHTML = Object.keys(dimensionAverages).map(dim => {
                const avg = dimensionAverages[dim];
                const percent = (avg / 4) * 100;
                let dimColor;
                if (avg < 1.5) dimColor = "#4CAF50";
                else if (avg < 2.5) dimColor = "#FF9800";
                else dimColor = "#F44336";
                
                return `
                    <div class="dimension">
                        <div class="dimension-name">
                            <span>${dim}</span>
                            <span style="color: ${dimColor}">${avg.toFixed(1)}分</span>
                        </div>
                        <div class="dimension-bar">
                            <div class="dimension-fill" style="width: ${percent}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // 清除本地存储
            localStorage.removeItem('npdTestAnswers');
        }

        // 重新开始测试
        function restartTest() {
            answers = new Array(questions.length).fill(null);
            currentQuestion = 0;
            testStarted = false;
            resultEl.style.display = 'none';
            welcomeEl.style.display = 'block';
            localStorage.removeItem('npdTestAnswers');
        }

        // 保存结果
        function saveResult() {
            const resultText = `NPD自恋型人格测试结果：
总分：${totalScoreEl.textContent}
风险等级：${riskLevelEl.textContent}
${resultDescEl.textContent}

测试时间：${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}

注：本测试结果仅供参考，不构成专业诊断。`;

            // 创建文本文件
            const blob = new Blob([resultText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `NPD测试结果_${new Date().toISOString().slice(0,10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('测试结果已保存为文本文件！');
        }

        // 事件监听
        startBtn.addEventListener('click', startTest);
        prevBtn.addEventListener('click', prevQuestion);
        nextBtn.addEventListener('click', nextQuestion);
        restartBtn.addEventListener('click', restartTest);
        shareBtn.addEventListener('click', saveResult);

        // 页面加载时检查是否有未完成的测试
        document.addEventListener('DOMContentLoaded', loadAnswers);
    </script>
</body>
</html>
